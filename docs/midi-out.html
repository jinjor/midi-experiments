<!-- Thanks to https://github.com/tanikawa04/webmidiapi_to_daw_sample -->
<h1>Web MIDI API Sample</h1>
<p>
    <label for="output_selector">MIDI Output Port: </label>
    <select name="output_selector" id="output_selector"></select>
</p>
<p>
    <button id="play_button">Play</button>
</p>

<script>

const outputSelector = document.getElementById('output_selector');
const playButton = document.getElementById('play_button');

let outputs,
    output;

let playing = false;

const getSelectedOutput = () => {
    const index = outputSelector.selectedIndex;
    const portId = outputSelector[index].value;
    return outputs.get(portId);
};

const playC = () => {
    playing = true;
    output.send([0x90, 60, 100]);
};

const stopC = () => {
    if (playing) {
        playing = false;
        output.send([0x90, 60, 0]);
    }
};

navigator.requestMIDIAccess()
    .then(midiAccess => {
        outputs = midiAccess.outputs;
        for (let output of outputs.values()) {
            const optionEl = document.createElement('option');
            optionEl.text = output.name;
            optionEl.value = output.id;
            outputSelector.add(optionEl);
        }
        output = getSelectedOutput();
    })
    .catch(err => {
        console.log(err);
    });

outputSelector.addEventListener('change', () => {
    output = getSelectedOutput();
});

playButton.addEventListener('mousedown', () => {
    playC();
});

playButton.addEventListener('mouseup', () => {
    stopC();
});

playButton.addEventListener('mouseout', () => {
    stopC();
});
</script>
